---
  name: playwright-automation
  on:
    push:
      branches:
        - main
    schedule:
      - cron: 45 9 * * *
      - cron: 50 9 * * *
  jobs:
    build:
      name: Run end-to-end tests
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
          with:
            fetch-depth: 0
        - uses: actions/setup-node@v3
          with:
            node-version: "20"
        - name: install dependencies
          run: npm ci
        - name: install playwright
          run: npm install @playwright/test
        - name: run test environment
          env:
            test_env: test
          run: npx playwright test --project=chrome
        - uses: actions/upload-artifact@v2
          if: always()
          with:
            name: playwright-report
            path: playwright-report/
            retention-days: 30
        - name: Download zipped HTML report
          uses: actions/download-artifact@v2
          with:
            name: playwright-report
            path: playwright-report/
        - name: Post to a Slack channel
          id: slack
          uses: slackapi/slack-github-action@v1.24.0
          env:
           SLACK_BOT_TOKEN: 'https://hooks.slack.com/services/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'
           channel-id: 'C06A4RDR86N'
          with:
           channel-id: 'C06A4RDR86N'
           slack-message: "GitHub build result: ${{ job.status }}\n${{ github.event.pull_request.html_url || github.event.head_commit.url }}"
           payload: |
                      {
                        "text": "End to end test has failed",
                        "blocks": [
                          {
                            "type": "header",
                            "text": {
                              "type": "plain_text",
                              "text": ":bangbang: End to end test has failed",
                              "emoji": true
                            }
                          },
                          {
                            "type": "section",
                            "text": {
                              "type": "mrkdwn",
                              "text": "@here"
                            }
                          },
                          {
                            "type": "context",
                            "elements": [
                              {
                                "type": "mrkdwn",
                                "text": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                              }
                            ]
                          }
                        ]
                      }
  
